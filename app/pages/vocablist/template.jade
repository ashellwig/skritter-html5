gelato-page(data-name='vocablist')
  #navbar-container
  gelato-content
    .container
      .content-block
        .row

          - var sort = view.vocablist.get('sort');

          //----------------- SIDEBAR -----------------------------------------

          .col-md-3.sidebar
            .sidebar-spacer
              div
                if sort === 'official'
                  a.back-link(href="/vocablist/browse")
                    span.glyphicon.glyphicon-chevron-left
                    span back to official lists

                else if sort === 'custom' && view.vocablist.get('creator') === app.user.id
                  a.back-link(href="/vocablist/my-lists")
                    span.glyphicon.glyphicon-chevron-left
                    span back to my lists

                else if sort
                  // TODO: add links to other custom lists and ChinesePod
                  a.back-link(href="/vocablist/queue")
                    span.glyphicon.glyphicon-chevron-left
                    span back to lists

              div#list-img-wrapper
                img#list-img.img-thumbnail(src=view.vocablist.getImageUrl())
                #missing-image-stub.hide
                  span.glyphicon.glyphicon-book

                i.fa.fa-5x.fa-spinner.fa-pulse.hide

                if view.vocablist.editable()
                  #image-upload-prompt
                    a#image-upload-link
                      span.glyphicon.glyphicon-plus-sign
                      span.spl Change photo
                  input#image-upload-input.hide(type="file", accept="image/*")

              if !view.vocablist.get('disabled') && view.vocablist.state !== 'fetching'

                p
                  if view.vocablist.state === 'saving'
                    button.btn.btn-fixed.btn-success(disabled=true) Saving changes

                  else if view.vocablist.get('studyingMode') === 'not studying'
                    button#add-to-queue-btn.btn.btn-fixed.btn-success Add to queue

                  else
                    a.btn.btn-fixed.btn-primary Study now

                p.status-p
                  span.spr Status:
                  span= _.capitalize(view.vocablist.get('studyingMode'))

                if view.vocablist.get('studyingMode') !== 'not studying'
                  - var progress = view.vocablist.getProgress();
                  - var title = progress.percent.toFixed(1)+'% complete';
                  if progress.total
                    - title += ' ('+(progress.total - progress.added)+' left)';
                  .progress(title=title, data-toggle="tooltip" data-placement="top")
                    .progress-bar(style="width:"+progress.percent+'%')

                hr

                .actions
                  if view.vocablist.get('studyingMode') !== 'not studying'
                    div.action
                      a#study-settings-link
                        span.glyphicon.glyphicon-cog
                        span Study Settings

                  if view.vocablist.publishable()
                    a#publish-link
                      div.action
                        span.glyphicon.glyphicon-share
                        span Publish

                  if view.vocablist.copyable()
                    a#copy-link
                      div.action
                        span.glyphicon.glyphicon-duplicate
                        span Copy

                  if view.vocablist.deletable()
                    a#delete-link
                      div.action
                        span.glyphicon.glyphicon-trash
                        span Delete

                  //div.action
                  //  span.glyphicon.glyphicon-blackboard
                  //  span Assign to group
                  //
                  //div.action
                  //  span.glyphicon.glyphicon-export
                  //  span Export


          //----------------- CONTENT -----------------------------------------

          .col-md-9.main-content
            if view.vocablist.state === 'fetching'
              p.text-center
                i.fa.fa-3x.fa-spinner.fa-pulse

            else
              - var tags = view.vocablist.get('tags') || [];

              #static-version

                if view.vocablist.editable()
                  a#edit-link.glyphicon.glyphicon-pencil.pull-right.static-el

                .title.static-el
                  span= view.vocablist.get('name')

                div#stats-line
                  span.spr Made by:
                  if sort === 'official'
                    span Skritter
                  else if sort === 'chinesepod-lesson'
                    span ChinesePod
                  else if view.vocablist.get('creator') === app.user.id
                    span= app.user.get('name') || app.user.id
                  else
                    if view.creator && view.creator.state === 'standby'
                      span= view.creator.get('name') || view.creator.id
                    else
                      span(data-user-id=view.vocablist.get('creator')) ...
                  span.spl.spr |

                  if view.vocablist.get('published')
                    span.spr Published:
                    span= moment(view.vocablist.get('published')).format('LL')
                    span.spl.spr |

                  if view.vocablist.get('published') && view.vocablist.get('peopleStudying')
                    span.spr Studied by:
                    span= view.vocablist.get('peopleStudying')
                    span.spl.spr |

                  span.spr Words:
                  span= view.vocablist.getWordCount()

                p.static-el!= view.vocablist.get('description').replace(/\n/g, '<br />')

                #tags.static-el
                  for tag in tags
                    span.tag
                      span.glyphicon.glyphicon-tag
                      span.spl= tag

              #editing-version.hide

                #edit-row
                  input#name-input.form-control.input-lg(value=view.vocablist.get('name'))
                  a#cancel-edits-link Cancel
                  button#save-edits-btn.btn.btn-success.btn-fixed Save edits

                textarea#description-textarea.form-control= view.vocablist.get('description')

                input#tags-input.form-control(value=tags.join(', '))
                .help-block Separate tags with commas

              .header Sections

              .table-oversized-wrapper
                table.table
                  - var sectionsSkipping = view.vocablist.get('sectionsSkipping') || [];

                  for section, i in view.vocablist.get('sections')
                    tr(class=i%2 ? 'even-row' : 'odd-row')
                      td= section.name
                      td
                        | #{section.rows.length} word
                        if section.rows.length !== 1
                          | s
                      td
                        if section.completed
                          span.spr Completed
                          span= moment(section.completed).format('L')
                        else if _.contains(sectionsSkipping, section.id)
                          | Skipping
                        else if section.id === view.vocablist.get('currentSection')
                          | Adding